
function TaskListCtrl($scope,tasks,session){session.auth();var userId=localStorage.id;var overActive;tasks.getAll().then(function(response){if(response.data!=='error'){$scope.tasks=response.data;};});$('.col-md-3').on('dragend','.panel',function(event){var taskList=[];var stateName=$(this).parent().attr('data-state');var index=$(this).attr('data-index');var targetState=$(overActive).attr('data-state');for(task in $scope.tasks){if($scope.tasks[task].stateName===stateName){taskList.push($scope.tasks[task]);};};var targetTask=taskList[index];var targetTaskId=targetTask['id'];var targetTaskUserAssigned=targetTask['userAssigned'];if(parseInt(userId)===targetTaskUserAssigned){targetTask.stateName=targetState;targetTask.userAssigned=userId;targetTask.state=tasks.getStateNumber(targetState);var targetTaskData=JSON.stringify(targetTask);tasks.edit(targetTaskId,targetTaskData).then(function(response){if(response.data==='Task data edited'){tasks.getByProject(projectId).then(function(response){if(response.data!=='error'){$scope.tasks=response.data;};});}});}else{return;};});$('.col-md-3').on('dragover',function(event){$(this).addClass('bg-info');overActive=$(this);});$('.col-md-3').on('dragleave',function(event){$(this).removeClass('bg-info');});};